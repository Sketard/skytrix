<div class="deckBuilder" cdkDropListGroup>
  <!-- BODY (canvas + side panel with header) -->
  <div class="deckBuilder-body">
    <div class="deckBuilder-canvasParent">
      <button
        mat-icon-button
        class="deckBuilder-searchToggle"
        aria-label="Rechercher une carte"
        (click)="toggleSearchPanel()">
        <mat-icon>search</mat-icon>
      </button>
      <deck-viewer (cardClicked)="onCardClicked($event)"></deck-viewer>
    </div>
    <div class="deckBuilder-side" [class.opened]="searchPanelOpened()">
      <button
        mat-icon-button
        class="deckBuilder-side-close"
        aria-label="Fermer le panneau"
        (click)="toggleSearchPanel()">
        <mat-icon>close</mat-icon>
      </button>
      <!-- HEADER (inside side panel) -->
      <div class="deckBuilder-side-header">
        <mat-form-field class="deckBuilder-side-header-deckName">
          <input matInput placeholder="Nom du deck..." [(ngModel)]="deckBuildService.deck().name" />
        </mat-form-field>
        <div class="deckBuilder-side-header-row">
          <deck-card-zone
            [cardDetails]="deckBuildService.deck().images"
            [slotNumber]="3"
            (cardClicked)="onCardClicked($event)"></deck-card-zone>
          <button mat-icon-button [matMenuTriggerFor]="actionsMenu" aria-label="Actions du deck">
            <mat-icon>more_vert</mat-icon>
          </button>
          <mat-menu #actionsMenu="matMenu">
            <button mat-menu-item [disabled]="deckBuildService.deckEmpty()" (click)="save()">
              <mat-icon>save</mat-icon>
              <span>Sauvegarder</span>
            </button>
            <button mat-menu-item [disabled]="deckBuildService.deckEmpty()" (click)="createProxies()">
              <mat-icon>print</mat-icon>
              <span>Générer les proxies</span>
            </button>
            <button mat-menu-item (click)="export(ExportMode.CLASSIC)">
              <mat-icon>cloud_download</mat-icon>
              <span>Export standard</span>
            </button>
            <button mat-menu-item (click)="export(ExportMode.MARKET)">
              <mat-icon>cloud_download</mat-icon>
              <span>Export Cardmarket</span>
            </button>
            <button mat-menu-item (click)="openImportFile()">
              <mat-icon>cloud_upload</mat-icon>
              <span>Importer</span>
            </button>
            <button mat-menu-item (click)="toggleTestHand()">
              <mat-icon>back_hand</mat-icon>
              <span>Tester une main</span>
            </button>
            <button mat-menu-item [disabled]="!deckBuildService.deck().id" (click)="navigateToSimulator()">
              <mat-icon>sports_esports</mat-icon>
              <span>Simulateur</span>
            </button>
          </mat-menu>
        </div>
      </div>
      <div class="deckBuilder-side-searcher">
        <app-card-searcher
          [deckBuildMode]="true"
          [searchService]="deckBuildService"
          (cardClicked)="onCardClicked($event)"></app-card-searcher>
      </div>
      <div class="deckBuilder-side-filters" [class.opened]="filtersOpened()">
        <app-card-filters [searchService]="deckBuildService" [filtersOpened]="filtersOpened()" (close)="closeFilters()"></app-card-filters>
      </div>
    </div>
  </div>

  <input id="importDeckInput" hidden type="file" #importInput (change)="import()" />

  <!-- Portrait overlay (pure CSS media query — no TS logic) -->
  <div class="deckBuilder-portraitOverlay">
    <mat-icon>screen_rotation</mat-icon>
    <p>Tournez votre appareil en paysage</p>
  </div>

  <!-- Hand test overlay (outside canvas — no CDK drag needed) -->
  <div class="deckBuilder-handOverlay" [class.opened]="handTestOpened()">
    @if (handTestOpened()) {
      <app-hand-test></app-hand-test>
    }
  </div>
</div>

<app-card-inspector
  [card]="selectedCardForInspector()"
  mode="click"
  (dismissed)="dismissInspector()">
  <div class="inspector-actions" (click)="$event.stopPropagation()">
    <button mat-icon-button (click)="addSelectedCardToDeck()" title="Ajouter au deck">
      <mat-icon>add</mat-icon>
    </button>
    <button mat-icon-button (click)="removeSelectedCardFromDeck()" title="Retirer du deck">
      <mat-icon>remove</mat-icon>
    </button>
  </div>
</app-card-inspector>
