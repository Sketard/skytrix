<button mat-icon-button class="cardSearchPage-searchToggle"
  aria-label="Rechercher une carte"
  [attr.aria-expanded]="searchPanelOpened() && isMobilePortrait()"
  (click)="toggleSearchPanel()">
  <mat-icon>search</mat-icon>
</button>

<div class="cardSearchPage-desktop">
  <app-card-searcher
    [deckBuildMode]="false"
    [externalFilters]="!!useExternalFilters()"
    [searchService]="cardSearchService"
    (cardClicked)="onCardClicked($event)"
    (filtersExpanded)="onFiltersExpanded($event)">
  </app-card-searcher>
</div>

<div class="cardSearchPage-mobileResults cardSearchPage-searcher-result">
  <card-list
    [displayMode]="cardSearchService.displayMode()"
    [searchService]="cardSearchService"
    [deckBuildMode]="false"
    (cardClicked)="onCardClicked($event)">
  </card-list>
</div>

<app-bottom-sheet
  [opened]="searchPanelOpened() && isMobilePortrait()"
  [ariaLabel]="'Panneau de recherche de cartes'"
  [requestedSnap]="filtersRequestedSnap()"
  (closed)="searchPanelOpened.set(false)">
  <div class="cardSearchPage-sheet">
    <div class="cardSearchPage-sheet-bar">
      <search-bar
        [form]="cardSearchService.filterForm.controls.name"
        [searchService]="cardSearchService">
      </search-bar>
      <div class="cardSearchPage-sheet-bar-displayMode">
        <mat-button-toggle-group
          hideSingleSelectionIndicator
          (change)="setDisplayMode($event.source.value)">
          <mat-button-toggle [value]="displayType.GRID" [checked]="cardSearchService.displayMode() === displayType.GRID" matTooltip="Grille" aria-label="Grille">
            <mat-icon>view_module</mat-icon>
          </mat-button-toggle>
          <mat-button-toggle [value]="displayType.LIST" [checked]="cardSearchService.displayMode() === displayType.LIST" matTooltip="Liste" aria-label="Liste">
            <mat-icon>view_headline</mat-icon>
          </mat-button-toggle>
        </mat-button-toggle-group>

        <button mat-icon-button
          class="favorite-toggle-btn"
          [class.active]="cardSearchService.favoriteFilter()"
          (click)="toggleFavoriteFilter()"
          matTooltip="Favoris" aria-label="Favoris">
          <mat-icon>{{ cardSearchService.favoriteFilter() ? 'star' : 'star_border' }}</mat-icon>
        </button>
      </div>
    </div>
    <div class="cardSearchPage-sheet-filters">
      <app-card-filters
        [searchService]="cardSearchService">
      </app-card-filters>
    </div>
  </div>
</app-bottom-sheet>

<app-bottom-sheet
  class="cardSearchPage-externalFilters"
  [opened]="externalFiltersOpened()"
  [ariaLabel]="'Panneau de filtres'"
  (closed)="externalFiltersOpened.set(false)">
  <app-card-filters
    [searchService]="cardSearchService">
  </app-card-filters>
</app-bottom-sheet>

<app-card-inspector
  [card]="selectedCardForInspector()"
  mode="click"
  [ownedCount]="selectedCardOwnedCount()"
  [isFavorite]="selectedCardDetail()?.favorite ?? false"
  (ownedCountChange)="onOwnedCountChange($event)"
  (favoriteChange)="onFavoriteChange()"
  (dismissed)="dismissInspector()">
</app-card-inspector>
