<div
  class="cardsContainer"
  [ngClass]="displayMode()"
  [class.deckBuildMode]="deckBuildMode()"
  cdkDropList
  cdkDropListSortingDisabled
  [cdkDropListData]="{ source: 'search' }"
  (cdkDropListDropped)="onDrop($event)">
  @for (cd of cardsDetails$() | async; track cd.card.id) {
    @if (displayMode() === displayType.OWNED) {
      @for (set of cd.sets; track set.id) {
        @if (ownedCardService.shortOwnedCards$ | async | findOwnedCard: set.id; as ownedCard) {
          <div class="owned-row" (click)="onCardClick(cd)">
            <div class="owned-row-quantity">
              <button mat-icon-button (click)="increaseQuantity(-1, ownedCard.cardSetId, ownedCard.number); $event.stopPropagation()">
                <mat-icon>remove</mat-icon>
              </button>
              <span class="owned-row-quantity-count">{{ ownedCard.number }}</span>
              <button mat-icon-button (click)="increaseQuantity(1, ownedCard.cardSetId, ownedCard.number); $event.stopPropagation()">
                <mat-icon>add</mat-icon>
              </button>
            </div>
            <div class="owned-row-code">{{ set.code }}</div>
            <div class="owned-row-card">
              <app-card class="owned-card-image" [card]="toSharedCardData(cd)" />
              <div class="owned-row-card-name">{{ cd.card.name }}</div>
            </div>
            <div class="owned-row-rarity" [ngClass]="set.cssRarityCode">{{ set.rarity }}</div>
          </div>
        }
      }
    } @else {
      <div class="card-wrapper" [ngClass]="displayMode()"
           cdkDrag
           [cdkDragDisabled]="!deckBuildMode()"
           [cdkDragData]="cd"
           (cdkDragStarted)="onDragStart($event)"
           (cdkDragEnded)="onDragEnd()"
           (dblclick)="onDoubleClick(cd, $event)"
           (click)="onCardClick(cd)">
        <div class="card-image-container">
          <app-card [card]="toSharedCardData(cd)" />
          @if (cd.card.banInfo < 3) {
            <div class="ban-badge">
              <div>{{ cd.card.banInfo }}</div>
            </div>
          }
          @if (deckBuildMode()) {
            @if (ownedCardService.shortOwnedCards$ | async | findGroupedOwnedCard: cd; as count) {
              @if (count > 0) {
                <div class="owned-count">{{ count }}</div>
              }
            }
          }
        </div>
        @if (displayMode() === displayType.INFORMATIVE) {
          <div class="card-info">
            <strong>{{ cd.card.name }}</strong>
            <div class="card-info-icons">
              @if (cd.card.hasAttributeIcon) {
                <span class="card-info-icons-icon">
                  <img [src]="'assets/images/attributes/' + cd.card.attribute + '.svg'" [alt]="cd.card.attribute" />{{ cd.card.attribute }}
                </span>
              }
              <span class="card-info-icons-icon">
                @if (cd.card.isMonster) {
                  <img [src]="'assets/images/races/' + cd.card.race + '.webp'" [alt]="cd.card.race" />
                }
                {{ cd.card.race }}
              </span>
            </div>
            <div>
              <span>{{ cd.card.displayAtk }}</span>
              @if (cd.card.hasDefense) {
                / <span>{{ cd.card.displayDef }}</span>
              } @else if (cd.card.isLink) {
                / Lien <span>{{ cd.card.linkval }}</span>
              }
            </div>
          </div>
        }
      </div>
    }
  }
  @let svc = searchService();
  @if (svc?.isLoading()) {
    <div class="scroll-indicator">
      <mat-spinner diameter="32"></mat-spinner>
    </div>
  } @else if (svc && !svc.hasMoreResults() && svc.cardsDetails.length) {
    <div class="scroll-indicator scroll-indicator--end" role="status" aria-live="polite">
      Fin des r√©sultats
    </div>
  }
</div>
