# Retrospective — Epic 9: UI/UX Modernization (Screen Implementation Guide)

**Date:** 2026-02-18
**Facilitator:** Bob (Scrum Master)
**Epic Status:** 14/14 stories done — 2 regression bugs identified

---

## Team Participants

| Name | Role |
|------|------|
| Bob | Scrum Master (Facilitator) |
| Alice | Product Owner |
| Charlie | Senior Dev |
| Dana | QA Engineer |
| Elena | Junior Dev |
| Axel | Project Lead |

---

## Epic Summary & Metrics

**Delivery Metrics:**

- Stories completed: 14/14 (100%)
- Duration: 3 days (2026-02-16 to 2026-02-18)
- New files created: 4 (tokens, confirm-dialog, bottom-sheet components)
- Files modified: 40+ across the codebase
- Components detached from old SCSS variable system: 6+

**Quality & Technical:**

- Review findings across 14 stories: ~60 total
  - High severity: ~10 (all fixed)
  - Medium severity: ~25 (all fixed)
  - Low severity: ~25 (mostly fixed, 2 noted/deferred)
- Technical debt items accumulated: 7
- Production incidents: 0
- Regression bugs found in manual testing: 2 (High priority)
- Build budget errors: pre-existing (1.57 MB > 1 MB limit), unrelated to Epic 9

**Business Outcomes:**

- Unified dark theme across entire application
- Simulator retains distinct navy/cyan identity via scoped `:host` overrides
- Modern Material theming pattern validated (`--mdc-*`, `--mat-*`)
- Bottom sheet custom component delivered (highest-risk story)
- Zero new dependencies added

---

## Successes

1. **Screen Implementation Guide (Sally)** — The per-screen audit format with numbered issues, severity, key files, risk analysis, and risk-minimized implementation order was the most actionable planning document the team has produced. The 14 stories mapped directly to the 14 implementation steps. Zero architectural surprises.

2. **"Zero regression by design" pattern** — Story 9-1 defined tokens without consuming them. Each subsequent story migrated only the components it touched. The app was never broken between stories.

3. **Material custom property pattern** — Validated in Story 9-3 and reused across 9-7, 9-14. `--mdc-*` / `--mat-*` custom properties replaced deprecated `::ng-deep` patterns.

4. **Bottom sheet delivery** — Highest-risk story (9-13) delivered successfully: vanilla pointer events, velocity-based snap, `visualViewport` API, CDK drag cross-boundary. Custom-built with no new dependencies.

5. **Code review as safety net** — ~60 findings caught across 14 stories, including 10 High severity. Accessibility gaps, race conditions, CSS cascade bugs — all caught before merge.

6. **Risk-minimized execution order** — Dependencies flowed forward perfectly: tokens (9-1) → sidebar (9-2) → search bar (9-3) → each subsequent story validated and built on the previous pattern.

---

## Challenges

1. **Accessibility blind spot (systemic)** — 3 stories (9-4, 9-7, 9-14) had WCAG gaps caught only in review: missing `aria-label` on icon buttons, missing `tabindex`/`role`/`keydown` on interactive non-native elements, missing `aria-live` on dynamic content. Never in the initial implementation.

2. **CSS cascade/specificity bugs** — 2 stories (9-8, 9-13) had source order or stacking context issues. In 9-8, landscape overrides were placed BEFORE base rules, making them ineffective.

3. **Signal-based race conditions** — 2 stories (9-7, 9-14) had timing issues. Debounce gap in 9-7 (`startEditingName()` not clearing pending timeout). `isLoadingState` not reset at `fetch()` entry in 9-14.

4. **`rgba(var())` gap detected late** — The token system was designed with hex values in 9-1, but `rgba(var(--hex), alpha)` doesn't work in CSS. Discovered in 9-12 instead of 9-1. Required hardcoding derived rgba values as CSS custom properties.

5. **`replace_all` prefix collision** — In 9-12, `$sim-surface` also matched `$sim-surface-elevated`, producing malformed `var(--sim-surface)-elevated`. Tooling risk for variable rename operations.

---

## Key Insights

1. The "per-screen audit + risk analysis + implementation order" format from Sally is a massive accelerator for UX modernization epics — reproduce it for future epics.
2. Code review catches systemic bugs, but prevention (checklists, conventions) is better than detection.
3. Manual user testing on device reveals bugs that code review cannot see (bottom sheet header overlap, infinite scroll regression).
4. CSS custom properties on `:root` with `:host` overrides is a clean, scalable theming architecture.
5. Dual component instances sharing a service (bottom sheet pattern) is simpler than moving a single instance between containers.

---

## Previous Retrospective Follow-Through

No Epic 8 retrospective document found (`epic-8-retrospective: done` in sprint-status but no file saved). This is the first documented retrospective.

---

## Bugs Identified (High Priority)

### BUG-1: Bottom sheet 100% snap hides drag handle under header

- **Priority:** High
- **Owner:** Charlie (Senior Dev)
- **Description:** At 100% snap, the bottom sheet extends behind the header. The drag handle is hidden, making it impossible to collapse or dismiss via drag gesture.
- **Root cause:** Snap point calculation uses full viewport height without accounting for header height.
- **Fix:** Calculate snap points relative to available space below header: `calc(100dvh - var(--header-height))`.
- **Success criteria:** Drag handle is always visible and functional at all snap points.

### BUG-2: Infinite scroll trigger broken

- **Priority:** High
- **Owner:** Charlie (Senior Dev)
- **Description:** The scroll event listener no longer triggers new fetches. Broken on: card search page (desktop + mobile), deck builder (mobile). Works: deck builder (desktop).
- **Root cause (hypothesis):** Cumulative CSS changes from stories 9-5 (grid gap), 9-6 (sticky headers), 9-8 (toggles landscape) likely changed the scroll container. The scroll listener in `search-service-core` is attached to the wrong element.
- **Fix:** Investigate which element carries `overflow: auto`/`overflow-y: scroll` in each context. Reattach listener to correct container.
- **Success criteria:** Infinite scroll triggers correctly on all screens at all breakpoints.

---

## Action Items

### Process Improvements

| # | Action | Owner | Success Criteria |
|---|--------|-------|-----------------|
| 1 | Create minimal WCAG accessibility checklist for pre-review | Dana (QA) | Checklist covers: `aria-label` on icon buttons, `tabindex`/`role`/`keydown` on non-native interactive elements, `aria-live` on dynamic content. Integrated into story template. |
| 2 | Document CSS cascade/specificity conventions | Charlie (Senior Dev) | Rule documented: media queries/overrides MUST be placed AFTER base rules in the same selector block. Pattern from 9-8 doesn't recur. |

### UX Improvements

| # | Action | Owner | Success Criteria |
|---|--------|-------|-----------------|
| 3 | Add 'collapsed' snap point to bottom sheet | Charlie (Senior Dev) | Fourth snap state at ~15-20% showing handle + search bar. Drag down from 60% → collapsed. Drag down from collapsed → dismiss. Drag up from collapsed → 60%. |
| 4 | Improve 'Create deck' ghost card discoverability | Elena (Junior Dev) | Add text label ("Nouveau deck" or "Créer") below icon + permanent `--accent-primary-dim` background. New users immediately identify the card as a creation action. |

### Technical Debt

| # | Action | Owner | Priority |
|---|--------|-------|----------|
| 5 | Migrate `@import` to `@use`/`@forward` in `styles.scss` | Charlie | Low |
| 6 | Semantic headers in deck-viewer (`<h2>`/`<h3>` instead of `<div>`) | Elena | Low |
| 7 | Add user feedback on HTTP errors in search-service-core | Charlie | Low (MVP acceptable) |
| 8 | Investigate and fix build budget errors (1.57 MB > 1 MB) | Charlie | Medium |

### Strategic Opportunities

| # | Action | Owner | Notes |
|---|--------|-------|-------|
| 9 | Generalize bottom sheet for mobile filters | Alice + Charlie | Replace `card-filters` drawer slide-in with bottom sheet on mobile portrait. Priority: standalone search page. Evaluate deck builder separately (already has bottom sheet). Requires abstracting bottom sheet component first. |
| 10 | Reproduce Sally's Screen Implementation Guide format | Sally (UX Designer) | For future UX epics: per-screen audit at 3 breakpoints, numbered issues with severity, key files, risk analysis, risk-minimized implementation order. |

---

## Readiness Assessment

| Dimension | Status |
|-----------|--------|
| Testing & Quality | 2 High-priority regression bugs identified via manual testing |
| Deployment | Local only (no prod pipeline for MVP) |
| Stakeholder Acceptance | Axel tested and provided feedback |
| Technical Health | Solid overall, 7 manageable tech debt items |
| Unresolved Blockers | 2 bugs must be fixed before marking epic as "done" |

**Verdict:** Epic 9 is complete from a story perspective (14/14 done) but requires 2 High-priority bug fixes before being marked `done` in sprint-status.

---

## Next Steps

1. **Fix BUG-1** (bottom sheet header overlap) and **BUG-2** (infinite scroll trigger)
2. Review action items in next standup
3. Mark Epic 9 as `done` in sprint-status after bug fixes verified
4. Plan next work (no Epic 10 defined — end of current roadmap)

---

*Generated: 2026-02-18 | Facilitator: Bob (Scrum Master) | Project: skytrix*
